<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./assets/favicon.ico" />
    <title>短连接</title>

    <!-- 添加依赖库 -->
    <script src="../libs/marked/marked.min.js"></script>
    <link rel="stylesheet" href="../libs/github-markdown-css/github-markdown.min.css">
    <script src="../libs/highlight.js/highlight.min.js"></script>
    <!-- 浅色模式默认主题 -->
    <link rel="stylesheet" 
    href="../libs/highlight.js/styles/github.min.css">
    <!-- 深色模式覆盖主题 -->
    <link rel="stylesheet" 
    href="../libs/highlight.js/styles/github-dark.min.css"
    media="(prefers-color-scheme: dark)">
    <style>
      :root {
        /* 浅色模式默认值 */
        --page-bg: #ffffff;
        --card-bg-start: #fafafa;
        --card-bg-end: #ebebeb;
        --title-color: #353535;
        --text-color: #353535;
        --secondary-text: #767676;
        --code-bg: #f6f8fa;
        --border-color: #eaecef;
        --shadow-main: 0 5px 15px 0 rgba(0,0,0,0.15);
        --shadow-hover: 0 5px 5px 0 rgba(0,0,0,0.15);
        --button-border: #a5dc86;
        --button-text: #a5dc86;
        --button-hover-bg: #a5dc86;

        --success-text: #52C41A;
        --warn-text: #FAAD14;
        --error-text: #FF4D4F;
        --info-text: #227AF5;
        --success-bg: #F6FFED;
        --warn-bg: #FFFBE6;
        --error-bg: #FFF2F0;
        --info-bg: #E6F4FF;
        --font-family: system-ui, 'Microsoft YaHei', sans-serif;
      }

      /* 深色模式覆盖 */
      @media (prefers-color-scheme: dark) {
        :root {
          --page-bg: #1a1a1a;
          --card-bg-start: #2d2d2d;
          --card-bg-end: #1a1a1a;
          --title-color: #e0e0e0;
          --text-color: #cccccc;
          --secondary-text: #909090;
          --code-bg: #2d2d2d;
          --border-color: #404040;
          --shadow-main: 0 5px 15px 0 rgba(0,0,0,0.4);
          --shadow-hover: 0 5px 5px 0 rgba(0,0,0,0.4);
          --button-border: #6a9955;
          --button-text: #6a9955;
          --button-hover-bg: #6a9955;

          --success-text: #49AA19;
          --warn-text: #D89614;
          --error-text: #DC4446;
          --info-text: #1668DC;
          --success-bg: #162312;
          --warn-bg: #2B2111;
          --error-bg: #2C1618;
          --info-bg: #111A2C;
        }
      }

      body {
        font-family: var(--font-family);
        background: var(--page-bg);
        color: var(--text-color);
        line-height: 1.5;
        margin: 0;
        padding: 20px;
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      button{
        font-family: var(--font-family);
      }

      .container {
        max-width: 980px;
        margin: 0 auto;
      }

      .box {
        margin: 2rem 0;
        padding: 1rem !important;
        background: linear-gradient(135deg, var(--card-bg-start), var(--card-bg-end));
        border-radius: 10px;
        box-shadow: var(--shadow-main);
        transition: all 0.3s ease;
      }

      .box:hover {
        box-shadow: var(--shadow-hover);
      }

      .titleText {
        font-size: 2em !important;
        border-bottom: 1px solid var(--border-color);
        padding: 0 2% 0.3em !important;
        margin: 0 0 1em;
        color: var(--title-color);
      }

      .timeText {
        font-size: 14px;
        color: var(--secondary-text);
        padding: 0 2%;
        margin: 0 0 1em;
      }
      /* 新增作者样式 */
      .meta-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 2%;
        margin: 0 0 1em;
      }

      .authorText {
        font-size: 14px;
        color: var(--secondary-text);
        font-style: italic;
      }

      .copy-button {
        float: right;
        border: none;
        border-radius: 10px;
        height: 24px;
        line-height: 25px;
        display: flex;
        font-size: 11px;
        background-color: transparent;
        cursor: pointer;
        transition: all 0.3s ease;
        align-items: center;
        color: var(--secondary-text);
      }
      
      .copy-button:hover {
        background-color: var(--border-color);
      }

      .markdown-body {
        font-family: var(--font-family);
        padding: 0 2% !important;
        background: transparent !important;
        color: var(--text-color);
      }

      .markdown-body pre {
        border: 1px solid var(--color-border-default);
        background-color: var(--code-bg);
        padding: 16px;
        border-radius: 6px;
        overflow-x: auto;
        transition: background-color 0.3s ease;
      }

      .markdown-body code {
        margin: 0rem 0.2rem 0rem 0.2rem;
        padding: 2px 5px;
        display: inline-flex;
        line-height: inherit;
      }

      .markdown-body kbd {
        font-size: 12px;
        margin: 0.2rem 0.2rem 0.3rem 0.2rem;
        padding: 0.2rem 0.3rem 0.4rem 0.3rem;
      }

      .markdown-body blockquote {
        padding: 1rem 1em;
        color: var(--color-accent-fg);
        border-left: .25em solid var(--color-accent-emphasis);
        background-color: var(--info-bg);
      }

      .markdown-body mark {
        background-color: var(--warn-text);
        color: var(--title-color);
      }

      .markdown-body del {
        font-style: italic;
        color: var(--secondary-text);
      }

      @media (max-width: 767px) {
        body {
          padding: 10px;
        }
        .container {
          padding: 0 10px;
        }
        .markdown-body {
          font-size: 14px;
        }
      }
      .icon {
        fill: var(--secondary-text) !important;
        transition: all 0.3s ease;
        margin-right: 0.2rem;
      }
      .icon-success {
        fill: var(--success-text) !important;
        transition: all 0.3s ease;
        margin-right: 0.2rem;
      }
    </style>

    <script>
      // Markdown 配置
      marked.setOptions({
        breaks: true,
        gfm: true,
        sanitize: true,
        highlight: function(code, lang) {
          return hljs.highlightAuto(code).value;
        }
      });

      var PATH_SEGMENTS_TO_SKIP = 0;

      function isUrl(url) {
        return /^[a-zA-z]+:\/\/[^\s]*$/.test(url);
      }

      function returnHome() {
        window.location.replace(
          location.protocol +
            '//' +
            location.hostname +
            (location.port ? ':' + location.port : '') +
            '/' +
            location.pathname.split('/')[PATH_SEGMENTS_TO_SKIP]
        );
      }

      function redirect() {
        var GITEE_ISSUES_LINK = atob('aHR0cHM6Ly9naXRlZS5jb20vYXBpL3Y1L3JlcG9zL3p3OTVjbi9zaG9ydHVybC1kYi9pc3N1ZXMv');
        var location = window.location;
        var issueNumber = location.pathname.split('/')[PATH_SEGMENTS_TO_SKIP + 1];
        var xhr = new XMLHttpRequest();

        xhr.onload = function () {
          if (xhr.status === 200) {
            var payload = JSON.parse(xhr.response);
            var message = payload.message;
            var titleText = payload.title;
            var bodyText = payload.body;
            var timeText = payload.updated_at;  
            var userName = payload.user?.name || '';

            var isInvalidUrl = message === 'Not Found' || 
                             message === 'This issue was deleted' || 
                             !titleText || 
                             (!isUrl(titleText) && !isUrl(bodyText));

            if (isInvalidUrl) {
              document.title = titleText;
              let container = document.createElement('div');
              container.className = 'container';

              let divObj = document.createElement('div');
              divObj.className = 'box';

              let titleObj = document.createElement('h1');
              titleObj.className = 'titleText';
              titleObj.textContent = titleText;

              // 创建元信息容器
              let metaContainer = document.createElement('div');
              metaContainer.className = 'meta-info';

              // 时间元素
              let timeObj = document.createElement('p');
              timeObj.className = 'timeText';
              let textTime = new Date(timeText);
              timeObj.textContent = textTime.toLocaleString();

              // 作者元素
              let authorObj = document.createElement('span');
              authorObj.className = 'authorText';
              authorObj.textContent = userName ? `作者：${userName}` :'';

              // 组装元素
              metaContainer.appendChild(timeObj);
              metaContainer.appendChild(authorObj);

              let copyBtnObj = document.createElement('button');
              copyBtnObj.className = 'copy-button';
              copyBtnObj.innerHTML = '<svg class="icon" width="0.8rem" height="0.8rem" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.65169 12.9243C3.68173 13.1045 3.74181 13.2748 3.80189 13.445C3.87198 13.6052 3.96211 13.7654 4.06225 13.9156C4.16238 14.0658 4.27253 14.206 4.4027 14.3362C4.52286 14.4663 4.66306 14.5765 4.81326 14.6766C4.96346 14.7768 5.11366 14.8569 5.28389 14.927C5.44411 14.9971 5.61434 15.0571 5.79459 15.0872C5.97483 15.1272 6.14506 15.1373 6.3253 15.1373V16.9196C6.30739 16.9196 6.28949 16.9195 6.27159 16.9193C5.9991 16.9158 5.72659 16.8859 5.4541 16.8295C5.16371 16.7694 4.88334 16.6893 4.61298 16.5692C4.3326 16.459 4.08226 16.3188 3.83193 16.1586C3.59161 15.9884 3.3613 15.7981 3.15102 15.5878C2.94074 15.3776 2.7605 15.1473 2.59027 14.9069C2.43006 14.6566 2.28986 14.3962 2.17972 14.1259C2.06957 13.8455 1.97944 13.5651 1.91936 13.2747C1.86929 12.9843 1.83926 12.684 1.83926 12.3936V6.26532C1.83926 5.96492 1.86929 5.67456 1.91936 5.38417C1.97944 5.09378 2.06957 4.80338 2.17972 4.53302C2.28986 4.26265 2.43006 4.0023 2.59027 3.75197C2.7605 3.50163 2.94074 3.27132 3.15102 3.06104C3.3613 2.85076 3.59161 2.67052 3.83193 2.50029C4.08226 2.33006 4.3326 2.19987 4.61298 2.07971C4.88334 1.96956 5.16371 1.87943 5.4541 1.81935C5.74449 1.75927 6.03491 1.73926 6.3253 1.73926H12.3934C12.6838 1.73926 12.9842 1.75927 13.2746 1.81935C13.555 1.87943 13.8354 1.96956 14.1158 2.07971C14.3861 2.19987 14.6465 2.33006 14.8868 2.50029C15.1371 2.67052 15.3574 2.85076 15.5677 3.06104C15.778 3.27132 15.9582 3.50163 16.1284 3.75197C16.2887 4.0023 16.4288 4.26265 16.539 4.53302C16.6592 4.80338 16.7393 5.09378 16.7994 5.38417C16.8558 5.65722 16.8858 5.93024 16.8892 6.21161C16.8894 6.22948 16.8895 6.24739 16.8895 6.26532H15.1271C15.1271 6.08508 15.1071 5.90486 15.067 5.72462C15.037 5.55439 14.9869 5.38415 14.9168 5.21392C14.8467 5.04369 14.7566 4.88347 14.6665 4.73327C14.5664 4.58307 14.4462 4.45289 14.326 4.32271C14.1959 4.19254 14.0557 4.08239 13.9055 3.98226C13.7553 3.88212 13.6051 3.79202 13.4348 3.72193C13.2746 3.65184 13.1044 3.60174 12.9242 3.5717C12.7539 3.53165 12.5737 3.51163 12.3934 3.51163H6.3253C6.14506 3.51163 5.97483 3.53165 5.79459 3.5717C5.61434 3.60174 5.44411 3.65184 5.28389 3.72193C5.11366 3.79202 4.96346 3.88212 4.81326 3.98226C4.66306 4.08239 4.52286 4.19254 4.4027 4.32271C4.27253 4.45289 4.16238 4.58307 4.06225 4.73327C3.96211 4.88347 3.87198 5.04369 3.80189 5.21392C3.74181 5.38415 3.68173 5.55439 3.65169 5.72462C3.61164 5.90486 3.60164 6.08508 3.60164 6.26532V12.3936C3.60164 12.5638 3.61164 12.744 3.65169 12.9243Z" ></path><path fill-rule="evenodd" clip-rule="evenodd" d="M9.66972 21.6772C9.39936 21.567 9.13902 21.4268 8.8987 21.2566C8.64836 21.0964 8.42804 20.9061 8.21776 20.6959C8.00748 20.4856 7.81723 20.2553 7.65701 20.015C7.4968 19.7646 7.3566 19.5043 7.24646 19.2239C7.12629 18.9535 7.04621 18.6731 6.98613 18.3727C6.92605 18.0823 6.89601 17.792 6.89601 17.4915V11.3733C6.89601 11.0729 6.92605 10.7825 6.98613 10.4922C7.04621 10.1918 7.12629 9.91137 7.24646 9.64101C7.3566 9.36063 7.4968 9.10028 7.65701 8.85996C7.81723 8.60962 8.00748 8.37931 8.21776 8.16903C8.42804 7.95875 8.64836 7.76849 8.8987 7.60828C9.13902 7.43805 9.39936 7.29785 9.66972 7.1877C9.94009 7.07755 10.2205 6.98745 10.5108 6.92737C10.8012 6.86729 11.0916 6.83725 11.392 6.83725H17.4602C17.7506 6.83725 18.041 6.86729 18.3313 6.92737C18.6217 6.98745 18.9021 7.07755 19.1725 7.1877C19.4529 7.29785 19.7032 7.43805 19.9535 7.60828C20.1938 7.76849 20.4242 7.95875 20.6345 8.16903C20.8447 8.37931 21.025 8.60962 21.1952 8.85996C21.3554 9.10028 21.4956 9.36063 21.6058 9.64101C21.7159 9.91137 21.806 10.1918 21.8661 10.4922C21.9162 10.7825 21.9462 11.0729 21.9462 11.3733V17.4915C21.9462 17.792 21.9162 18.0823 21.8661 18.3727C21.806 18.6731 21.7159 18.9535 21.6058 19.2239C21.4956 19.5043 21.3554 19.7646 21.1952 20.015C21.025 20.2553 20.8447 20.4856 20.6345 20.6959C20.4242 20.9061 20.1938 21.0964 19.9535 21.2566C19.7032 21.4268 19.4529 21.567 19.1725 21.6772C18.9021 21.7973 18.6217 21.8774 18.3313 21.9375C18.041 21.9976 17.7506 22.0276 17.4602 22.0276H11.392C11.0916 22.0276 10.8012 21.9976 10.5108 21.9375C10.2205 21.8774 9.94009 21.7973 9.66972 21.6772ZM10.8613 8.6697C11.0316 8.63966 11.2118 8.61965 11.392 8.61965H17.4602C17.6404 8.61965 17.8107 8.63966 17.9909 8.6697C18.1611 8.70975 18.3314 8.75983 18.5016 8.82992C18.6618 8.90001 18.822 8.98012 18.9722 9.08026C19.1224 9.18039 19.2626 9.30055 19.3828 9.42071C19.513 9.55088 19.6231 9.69109 19.7232 9.84129C19.8234 9.99149 19.9035 10.1517 19.9736 10.3219C20.0437 10.4821 20.0937 10.6624 20.1338 10.8326C20.1638 11.0129 20.1838 11.1931 20.1838 11.3733V17.4915C20.1838 17.6718 20.1638 17.852 20.1338 18.0323C20.0937 18.2125 20.0437 18.3828 19.9736 18.543C19.9035 18.7132 19.8234 18.8734 19.7232 19.0236C19.6231 19.1738 19.513 19.314 19.3828 19.4342C19.2626 19.5643 19.1224 19.6845 18.9722 19.7846C18.822 19.8848 18.6618 19.9649 18.5016 20.035C18.3314 20.1051 18.1611 20.1551 17.9909 20.1952C17.8107 20.2252 17.6404 20.2452 17.4602 20.2452H11.392C11.2118 20.2452 11.0316 20.2252 10.8613 20.1952C10.6811 20.1551 10.5108 20.1051 10.3506 20.035C10.1804 19.9649 10.0202 19.8848 9.87 19.7846C9.72982 19.6845 9.58962 19.5643 9.45945 19.4342C9.33929 19.314 9.21913 19.1738 9.119 19.0236C9.01886 18.8734 8.93875 18.7132 8.86866 18.543C8.79857 18.3828 8.74847 18.2125 8.71843 18.0323C8.67838 17.852 8.65836 17.6718 8.65836 17.4915V11.3733C8.65836 11.1931 8.67838 11.0129 8.71843 10.8326C8.74847 10.6624 8.79857 10.4821 8.86866 10.3219C8.93875 10.1517 9.01886 9.99149 9.119 9.84129C9.21913 9.69109 9.33929 9.55088 9.45945 9.42071C9.58962 9.30055 9.72982 9.18039 9.87 9.08026C10.0202 8.98012 10.1804 8.90001 10.3506 8.82992C10.5108 8.75983 10.6811 8.70975 10.8613 8.6697Z" ></path></svg>复制';
              copyBtnObj.addEventListener('click', function () {
                if (this.disabled) return;
                this.disabled = true;

                const rawText = document.querySelector(".markdown-body").dataset.raw;

                const textarea = document.createElement("textarea");
                textarea.value = rawText;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand("copy");
                document.body.removeChild(textarea);

                var originHTML = this.innerHTML;
                var originBackgroundColor = this.innerHTML;

                this.style.color = 'var(--success-text)';
                this.innerHTML = '<svg width="0.8rem" class="icon-success" height="0.8rem" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.338 21.575a1.058 1.058 0 0 1-.53-.363L2.275 13.17a1.063 1.063 0 0 1 1.65-1.341l5.63 6.928L19.33 3.86a1.064 1.064 0 0 1 1.778 1.167L10.551 21.115a1.065 1.065 0 0 1-1.213.46z" ></path></svg>已复制';
                setTimeout(() => {
                  this.innerHTML = originHTML;
                  this.style.color = '';
                  this.disabled = false;
                }, 1000);
              });

              let bodyObj = document.createElement('div');
              bodyObj.className = 'markdown-body';
              bodyObj.innerHTML = marked.parse(bodyText);
              bodyObj.dataset.raw = bodyText; // 保存原始文本

              divObj.appendChild(titleObj);
              divObj.appendChild(metaContainer);
              divObj.appendChild(copyBtnObj);
              divObj.appendChild(bodyObj);

              container.appendChild(divObj);
              document.body.appendChild(container);

              // 代码高亮
              hljs.highlightAll();
            } else {
              document.title = '跳转中...';
              isUrl(titleText) ? location.replace(titleText) : location.replace(bodyText);
            }
          } else {
            console.error(xhr.status+' '+xhr.response);
            returnHome();
          }
        };

        xhr.onerror = returnHome;
        xhr.open('GET', GITEE_ISSUES_LINK + issueNumber);
        xhr.send();
      }

      try {
        redirect();
      } catch (e) {
        console.error(e);
        returnHome();
      }
    </script>
  </head>
  <body></body>
</html>